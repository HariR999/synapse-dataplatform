{
	"name": "Serverless SQL JSON Queries",
	"properties": {
		"description": "SQL Script to query JSON files in datalake",
		"content": {
			"query": "-- Create a db master key if one does not already exist, using your own password.\n-- CREATE MASTER KEY ENCRYPTION BY PASSWORD='<EnterStrongPasswordHere>';\n\n-- Create a database scoped credential with the workspace managed IDENTITY\nCREATE DATABASE SCOPED CREDENTIAL [ba-synapse01-kn3acb6lw3vr4]\nWITH IDENTITY = 'MANAGED IDENTITY'\n\n-- Create EXTERNAL FILE Format as JSON not explicitly required for SQL Serverless. The format used by OPENROWSET is CSV\n\n--Create External Data Source\nCREATE EXTERNAL DATA SOURCE [sec-form10q]\nWITH (    LOCATION   = 'https://badatalake01kn3acb6lw3vr.dfs.core.windows.net/curated-silver/sec-form10q' --'https://<storage_account>.dfs.core.windows.net/<container>/<path>'\n          ,CREDENTIAL = [ba-synapse01-kn3acb6lw3vr4]\n)\n\n\n--Query Single file\nselect top 10 *\nfrom openrowset(\n        bulk '2023/04/standardized_2023-04-16_141247_sec-form10q.json/part-00000-f814e8bd-a2fe-4bbd-82d7-acef0a1625af-c000.json',\n        data_source = 'sec-form10q',\n        format = 'csv',\n        fieldterminator ='0x0b',\n        fieldquote = '0x0b',\n        ROWTERMINATOR = '0x0b'\n    ) with (doc nvarchar(max)) as rows\n\n\n--Query multiple files using wildcards\nselect top 10 *\nfrom openrowset(\n        bulk '*/*/*/part*.json',\n        data_source = 'sec-form10q',\n        format = 'csv',\n        fieldterminator ='0x0b',\n        fieldquote = '0x0b',\n        ROWTERMINATOR = '0x0b'\n    ) with (doc nvarchar(max)) as rows\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "dlsql01",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}